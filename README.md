# Redmine Status Report Plugin (Daoutech 커스텀 버전)

Redmine 일감의 상태별 통계 및 변경 이력을 시각화하는 플러그인입니다. Redmine 6 (Rails 7) 환경에 최적화되어 있으며, 보안 및 성능이 크게 개선되었습니다.

---

## 📋 주요 기능

### 1. 요약 통계
각 상태별로 머무른 총 시간을 합산하여 보여줍니다.

**예시:**

| 상태 | 유지 기간 |
|---------------|------------------------|
| 신규 | 6일 |
| 진행 | 29일 |
| 완료 | 5초 미만 |

### 2. 상태 변경 이력
시간 순서대로 상태가 변경된 내역과 각 단계에서 얼마나 머물렀는지를 보여줍니다.

**예시:**

| 상태 | 변경 일시 | 유지 기간 |
|-------------|-------------------|----------------------|
| 신규 | 2019-03-06 18:17 | 약 12시간 |
| 진행 | 2019-03-07 06:02 | 5초 미만 |
| 신규 | 2019-03-07 06:02 | 약 6시간 |
| 진행 | 2019-03-07 12:20 | 6일 |
| 완료 | 2019-03-17 18:45 | 현재 |

### 3. 시각적 프로그레스 바
각 상태의 비율을 시각적으로 확인할 수 있는 프로그레스 바를 제공합니다.

### 4. 다국어 지원
한국어 및 영어를 지원하며, 날짜/시간 표시가 사용자 환경에 맞게 자동으로 현지화됩니다.

### 5. 반응형 디자인
모바일 환경에서도 편리하게 사용할 수 있도록 가로 스크롤을 지원합니다.

---

## 🛠 환경 구성

본 플러그인은 아래 환경에서 개발 및 테스트되었습니다.

- **Redmine**: 5.0 이상 (Redmine 6.X 테스트 완료)
- **Ruby**: 2.7 이상
- **Rails**: 6.0 이상 (Rails 7 지원)
- **Database**: MySQL, PostgreSQL, SQLite 모두 지원

---

## 🔧 Daoutech 커스텀 개선 사항

### 1. 보안 강화 및 데이터베이스 호환성 확보 (2026.01.19)
- **문제점**: 기존 코드는 Raw SQL(`unix_timestamp` 등 MySQL 전용 함수 사용)과 문자열 보간법을 사용하여 **SQL Injection 위험**이 있었고, **PostgreSQL** 등 다른 DB를 지원하지 못했습니다.
- **해결**: SQL을 제거하고 **ActiveRecord**와 **Ruby 비즈니스 로직**으로 완전히 대체했습니다. 이제 DB 종류에 상관없이 안전하게 동작합니다.

### 2. 성능 최적화 및 최신 프론트엔드 표준 적용
- **문제점**: 단순한 탭 전환 기능을 위해 무거운 **jQuery** 라이브러리에 의존했습니다.
- **해결**: **Vanilla JS (ES6+)**로 재작성하여 외부 의존성을 제거하고 브라우저 네이티브 성능을 활용하도록 개선했습니다.

### 3. Redmine 6 / Rails 7 표준 준수 (Zeitwerk)
- **문제점**: 구버전 방식의 명시적 `require` 문과 파일 구조가 Rails 7의 **Zeitwerk 오토로더** 규칙과 충돌했습니다.
- **해결**: 파일 구조를 컨벤션에 맞게 정리하고(`hooks/hooks.rb` -> `hooks.rb`), `init.rb`를 최신 표준(`Rails.configuration.to_prepare`)으로 수정하여 안정성을 확보했습니다.

### 4. 코드 유지보수성 향상
- **문제점**: 뷰 파일(`erb`)에 인라인 스타일(`style="..."`)이 하드코딩되어 있어 테마 적용과 관리가 어려웠습니다.
- **해결**: 스타일을 별도 **CSS 파일**로 분리하고, 반복되는 UI 요소(프로그레스 바)를 **Helper 메서드**로 추출하여 코드 가독성과 재사용성을 높였습니다.

### 5. 다국어 지원 추가
- 한국어 설정 파일(`ko.yml`)을 추가하여 국내 사용자 환경을 지원합니다.

### 6. UI/UX 개선 (2026.01.20)
- **날짜/시간 표시 현지화**: 날짜 및 시간 표시 형식을 하드코딩된 영어 형식(`strftime`)에서 Redmine 설정 및 사용자 환경을 따르도록 `format_time` 헬퍼 사용으로 변경했습니다.
- **모바일 가로 스크롤 지원**: 모바일 등 좁은 화면에서 타임라인 테이블이 잘리지 않도록 `autoscroll` 래퍼를 적용하여 가로 스크롤을 지원합니다.
- **테이블 컬럼 너비 고정**: 반응형 환경(오토스크롤)에서도 테이블 헤더(`th`)의 너비가 찌그러지지 않도록 최소 너비(`min-width`) 스타일을 적용했습니다.
- **툴팁 다국어 처리**: 그래프 툴팁의 "of total time" 문구를 언어 파일(`en.yml`, `ko.yml`)로 분리하여 다국어를 지원합니다.

---

## 📦 설치 방법

### 1. 플러그인 다운로드
레드마인의 `plugins` 디렉토리로 이동하여 저장소를 복제합니다.  
⚠️ **폴더명은 반드시 `redmine_status_report`여야 합니다.**

```bash
cd {REDMINE_ROOT}/plugins
git clone [repository_url] redmine_status_report
```

### 2. 의존성 설치
레드마인 루트 디렉토리에서 번들러를 실행합니다.

```bash
cd {REDMINE_ROOT}
bundle install --without development test
```

### 3. 서버 재시작
변경 사항 적용을 위해 레드마인 서버를 재시작합니다.

```bash
# Apache/Passenger의 경우
touch tmp/restart.txt

# Puma/Unicorn의 경우
sudo systemctl restart redmine

# Docker의 경우
docker-compose restart redmine
```

> 💡 이 플러그인은 데이터베이스 마이그레이션이 필요하지 않습니다.

---

## ⚙️ 사용 방법

### 1. 일감 페이지 접속
레드마인에서 일감(Issue) 상세 페이지로 이동합니다.

### 2. 상태 보고서 탭 확인
일감 상세 페이지에서 **"상태 보고서(Status Report)"** 탭을 클릭합니다.

### 3. 통계 확인
- **요약 탭**: 각 상태별 총 지속 시간 확인
- **타임라인 탭**: 시간 순서대로 상태 변경 이력 확인

### 4. 프로그레스 바 확인
각 상태의 비율을 시각적으로 확인할 수 있습니다.

---

## 🗑 삭제 방법

### 1. 디렉토리 삭제
플러그인 디렉토리를 제거합니다.

```bash
cd {REDMINE_ROOT}
rm -rf plugins/redmine_status_report
```

### 2. 서버 재시작
서버를 재시작하여 플러그인을 완전히 제거합니다.

```bash
# Apache/Passenger의 경우
touch tmp/restart.txt

# Puma/Unicorn의 경우
sudo systemctl restart redmine

# Docker의 경우
docker-compose restart redmine
```

---

## 🎨 테마 호환성

이 플러그인은 다음 테마들과 잘 작동합니다:
- **PurpleMine 2**
- **Redmine Default Theme**
- **기타 대부분의 Redmine 테마**

---

## 📌 버전 정보

- **플러그인 버전**: 1.0.0, Daoutech 0.0.1
- **지원 Redmine 버전**: 6.0 이상 (Redmine 6.X 테스트 완료)

---

## 📝 라이선스

원본 프로젝트의 라이선스를 따릅니다.
